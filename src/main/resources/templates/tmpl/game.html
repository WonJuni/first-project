<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>총알 피하기 게임</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 0 auto;
        }
    </style>

</head>

<body>
    <canvas id="gameCanvas"></canvas>
    <button id="startButton" onclick="main()">
        <img th:src="@{/imgs/start.png}" width="150px" height="150px">
    </button>
    <div id="timer">시간: 0</div>
    <script>
        let canvas = document.querySelector('#gameCanvas');
        let ctx = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 400;

        let gameTimer; // 게임 타이머 변수
        let seconds = 0; // 초 카운터 변수

        let keysDown = {};

        let humanX = canvas.width / 2 - 32;
        let humanY = canvas.height - 64;
        let humanImage
        let shootImage

        function loadImage() {
            humanImage = new Image();
            humanImage.src = "./../imgs/human.png";
            shootImage = new Image();
            shootImage.src = "./../imgs/hamer.png";
        }


        function update() {
            if (39 in keysDown) {
                //right
                humanX += 5;
            } else if (37 in keysDown) {
                //left
                humanX -= 5;
            } else if (40 in keysDown) {
                //up
                humanY += 5;
            } else if (38 in keysDown) {
                //down
                humanY -= 5;
            }

        }

        function render() {
            ctx.drawImage(humanImage, humanX, humanY, 30, 30);
            for(let i =0; i<shootList.length; i++){
            cts.drawImage(shootImage,shootList[i].x,shootList[i].y);
            }
        }

        function animation() {
            update();
            render();
            requestAnimationFrame(animation);
        }

        function setupKeyboardListener() {
            document.addEventListener("keydown", function (event) {
                keysDown[event.keyCode] = true;
                console.log(keysDown);
            });

            document.addEventListener("keyup", function (event) {
                delete keysDown[event.keyCode];
                console.log(keysDown);
            })
        }
        function generateRandomValue(min,max){
            let randomNum =Math.floor(Math.random()*(max-min+1))+min
            return randomNum;
        }
        let shootList=[]

        function shoot(){
            this.x =0;
            this.y =0;
            this.init =function(){
            this.y= generateRandomValue(0,canvas.height-48)
            this.x= generateRandomValue(0,canvas.width-48)
            shootList.push(this);
            }
        }
        function createshoot(){
            const interval =setInterval(function(){
                let e =new shoot()
                e.init()
            },1000 )
        }
      

        function main() {
            loadImage();
            setupKeyboardListener();
            animation();
            gameTimer = setInterval(updateTimer, 1000);
            document.querySelector('#startButton').disabled = true;
        }

        function updateTimer() {
            // 초 카운터를 1씩 증가
            seconds++;
            
            // 화면에 시간을 업데이트
            document.querySelector('#timer').textContent = `시간: ${seconds}`;
        }

    

    </script>
</body>

</html>